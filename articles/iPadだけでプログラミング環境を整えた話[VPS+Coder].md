# iPadã ã‘ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç’°å¢ƒã‚’æ•´ãˆãŸè©±[VPS+Coder]

Created: 2021å¹´7æœˆ2æ—¥ 14:26
Updated: 2023å¹´2æœˆ14æ—¥ 8:46
Published_Time: 2023å¹´2æœˆ14æ—¥
Slug: programming-with-coder
Tags: iPad, é–‹ç™ºç’°å¢ƒ
Published: Yes
URL: https://blog.shaba.dev/posts/programming-with-coder

## ã¯ã˜ã‚ã«

GithubCodespacesãŒã¾ã ç„¡ã‹ã£ãŸæ™‚ä»£ã€‚

ãªã‚“ã¨ã‹iPadã‚’é–‹ç™ºãƒ‡ãƒã‚¤ã‚¹ã«ã—ãŸãã€è©¦è¡ŒéŒ¯èª¤ã—ãŸæœ«ã«ãŸã©ã‚Šç€ã„ãŸå½“æ™‚ã®é–‹ç™ºç’°å¢ƒã‚’å…¬é–‹ã—ã¾ã™ã€‚

ãªãŠã€ç¾åœ¨ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã®ã¨ãŠã‚ŠCodespacesã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ã¨ã¦ã‚‚ä¾¿åˆ©ã§ã‚ªã‚¹ã‚¹ãƒ¡ã€‚

[iPadã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ã®åŠªåŠ›ã¨2023å¹´å€‹äººçš„ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹[Blink+VSCode+Codespaces]](https://blog.shaba.dev/posts/coding-with-ipad)

## Coderã¨ã¯

[Coder](https://coder.com/)ã¨ã¯ã€Codespacesã¨åŒã˜ãã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§VSCodeãƒ©ã‚¤ã‚¯ãªæ“ä½œæ„Ÿã§é–‹ç™ºã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ãŒã€ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã§ä½¿ã†ã“ã¨ã‚‚å‡ºæ¥ã¦ã€ãã®å ´åˆã¯ç„¡æ–™ã§ã™ã€‚

[Coder - Remote development on your infrastructure](https://coder.com/)

ã‚µãƒ¼ãƒ“ã‚¹å…¬é–‹ç”¨ã®VPSã‚’æ—¢ã«å€Ÿã‚Šã¦ã„ãŸã®ã§ã€ãã“ã§ãƒ›ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚„ã¨ã„ã†ã“ã¨ã§ã€ä»Šå›ã¯ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

![F7635320-BD2A-4608-B6B3-4AAEB417F5E4.jpeg](F7635320-BD2A-4608-B6B3-4AAEB417F5E4.jpeg)

å®Ÿéš›ã«ã“ã‚“ãªæ„Ÿã˜ã§é–‹ç™ºã‚’ã—ã¦ã„ã¾ã—ãŸã€‚

ï¼ˆãã®å¾Œã€è‰²ã€…è¾›ã„ã¨ã“ã‚ãŒå‡ºã¦ãã¦vimã§ã®é–‹ç™ºã«ç§»è¡Œã—ã¾ã—ãŸãŒã€‚ã€‚ã€‚ï¼‰

## é‹ç”¨ã™ã‚‹ã¾ã§ã«ã‚„ã£ãŸã“ã¨

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

è©³ã—ã„æ‰‹é †ã¯å¿˜ã‚Œã¦ã—ã¾ã£ãŸã®ã§ã™ãŒã€å½“æ™‚ã¨ä»Šï¼ˆ2023å¹´2æœˆï¼‰ã¨ã¯ã¾ãŸè©±ãŒé•ã„ãã†ãªã®ã§ã€[github](https://github.com/coder/coder)ã‚’å‚ç…§ãã ã•ã„ã€‚

### ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å–å¾—

å½“æ–¹webã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ãŸã‹ã£ãŸã®ã§ã€é–‹ç™ºä¸­ã®ç”»é¢ã‚’ç¢ºèªã§ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

ãªã®ã§ã€Coderç”¨ã¨previewç”¨ã®2ã¤ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚‹éš›ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’å›ºå®šã—ã¦ã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã—ã¦ã„ã¾ã—ãŸã€‚

Codespacesã‚‚ä¼¼ãŸã‚ˆã†ãªä»•çµ„ã¿ã§ã™ã­ã€‚

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘¨ã‚Šã®è¨­å®š

æµçŸ³ã«é–‹ç™ºç’°å¢ƒã¨é–‹ç™ºç”»é¢ãŒèª°ã§ã‚‚è¦‹ã‚‰ã‚Œã‚‹çŠ¶æ…‹ã ã¨ãƒ¤ãƒã„ã®ã§ã€æœ€ä½é™ã®èªè¨¼ã§basicèªè¨¼ã‚’å…¥ã‚Œã¾ã—ãŸã€‚

ãŒã€webkitã®æ˜”ã‹ã‚‰ã‚ã‚‹ç¾è±¡ï¼Ÿã§ã€ websocketä½¿ç”¨æ™‚ã«basicèªè¨¼ãŒã†ã¾ãå‹•ã‹ãªã„ã‚‰ã—ãã€‚

[80362 - WebSocket: Client does not support 401 Unauthorized response.](https://bugs.webkit.org/show_bug.cgi?id=80362)

Coderã¯websocketã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã€iPadã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã™ã¹ã¦webkitãªã®ã§basicèªè¨¼ãŒåŠ¹ã‹ãšã€ã—ã°ã‚‰ãé ­ã‚’æŠ±ãˆã¾ã—ãŸã€‚

ä»•æ–¹ãªã„ã®ã§ã€code-serverå´ã¯å½“æ™‚ã‚‚ã†ä¸€ã¤æ°—ã«ãªã£ã¦ã„ãŸAuth0ã§OAuthåŒ–ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

oauth2ã‚’å°å…¥ã™ã‚‹æ‰‹é †ã¯ã“ã¡ã‚‰ã®ã‚µã‚¤ãƒˆæ§˜ãŒã¨ã¦ã‚‚ã‚ã‹ã‚Šæ˜“ã‹ã£ãŸã§ã™ã€‚

[oauth2_proxy ã¨ Auth0 ã‚’ç”¨ã„ãŸ Nginx ã®ãŠæ‰‹è»½ OAuth åŒ– Â· Yutaka ğŸŠ Kato](https://mikan.github.io/2018/05/23/enable-oauth-to-your-nginx-by-oauth2-proxy-and-auth0/)

ãƒ¡ãƒ³ãƒã‚’çµã‚‹ãªã‚‰ã€

1. rules -> create rule-> whitelistã§emailã‚’çµã‚‹
2. Users&roles ->Users->create Usersã§ãƒ¦ãƒ¼ã‚¶ä½œæˆ
3. Connections->Database->Disable SignUpsã‚’æœ‰åŠ¹

ã¨ã„ã†æ‰‹é †ã§ã§ããã†ã€‚

### SSLåŒ–

SSLåŒ–ã‚‚ã—ã¾ã™ã€‚ãŠãªã˜ã¿Letâ€™s Encryptã§ã™ãŒã€è¨­å®šé »åº¦ãŒé«˜ããªã„ã®ã§æ¯å›ã‚„ã‚Šæ–¹ã‚’å¿˜ã‚ŒãŒã¡ã§ã™ã€‚

ä½¿ã„æ–¹ã¯ä¸‹è¨˜ã‚µã‚¤ãƒˆæ§˜ãŒåˆ†ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚

[ã€ç„¡æ–™SSLå…¥é–€ã€‘ã€ŒLet's Encryptã€ã¨ã¯ï¼Ÿè¨­å®šã§æŒ«æŠ˜ã—ãªã„ï¼ä½¿ã„æ–¹è§£èª¬ - ã‚«ã‚´ãƒ¤ã®ã‚µãƒ¼ãƒãƒ¼ç ”ç©¶å®¤](https://www.kagoya.jp/howto/it-glossary/security/lets-encrypt/)

### nginxè¨­å®š

ä¸Šè¨˜ã‚’è¸ã¾ãˆãŸnginxã®è¨­å®šãŒã“ã¡ã‚‰ã§ã™ã€‚

ãƒãƒ¼ãƒˆç•ªå·1111ãŒOAuthèªè¨¼ç”¨ã€2222ãŒCoderç”¨ã€3333ãŒpreviewç”¨ã¨ã—ã¦ä½¿ã„åˆ†ã‘ã¦ã„ã¾ã™ã€‚

```
map $http_upgrade $connection_upgrade {
default upgrade;
'' close;
}
server {
server_name code.domain.com;
location /oauth2/ {
    proxy_pass http://localhost:1111;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_set_header X-Auth-Request_Redirect $request_uri;
}

location = /oauth2/auth {
    proxy_pass http://localhost:1111;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_set_header Content-Length "";
    proxy_pass_request_body off;
}

location / {
    #oauth2
    auth_request /oauth2/auth;
    error_page 401 = /oauth2/sign_in;
    auth_request_set $user $upstream_http_x_auth_request_user;
    auth_request_set $email $upstream_http_x_auth_request_email;
    proxy_set_header X-User $user;
    proxy_set_header X-Email $email;
    auth_request_set $auth_cookie $upstream_http_set_cookie;
    add_header Set-Cookie $auth_cookie;

    proxy_pass http://127.0.0.1:2222;
        #websocket
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginxX-Proxy true;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_redirect off;

    }
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/code.from-garage.work/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/code.from-garage.work/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

server {
    server_name preview.domain.com;
    location /webhook {
        proxy_pass http://127.0.0.1:3333;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location / {
        #Basic auth
        auth_basic "Restricted"; # èªè¨¼æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        auth_basic_user_file /etc/nginx/.htpasswd;

        proxy_pass http://127.0.0.1:3333;
        proxy_set_header Host $http_host;
       proxy_redirect off;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/preview.from-garage.work/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/preview.from-garage.work/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

server {
    if ($host = code.domain.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    listen 80;
    server_name code.domain.com;
    return 404; # managed by Certbot
}

server {
    if ($host = preview.domain.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    listen 80;
    server_name preview.domain.com;
  return 404; # managed by Certbot
}
```

### 1ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆ

ã ã„ãŸã„ã“ã‚“ãªæ„Ÿã˜ã®æ§‹æˆã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

ç´¹ä»‹ç¨‹åº¦ã«ã€‚

```python
â”œâ”€â”€ code_config_root
â”‚ â””â”€â”€ config.yaml
â”œâ”€â”€ docker
â”‚ â”œâ”€â”€ code-server
â”‚ â”‚ â”œâ”€â”€ app
â”‚ â”‚ â”œâ”€â”€ config
â”‚ â”‚ â”œâ”€â”€ config_backup
â”‚ â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”‚ â””â”€â”€ ssh
â”‚ â”œâ”€â”€ mysql
â”‚ â”‚ â”œâ”€â”€ docker-entry-point-init.db
â”‚ â”‚ â””â”€â”€ my.cnf
â”‚ â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ src
â”‚ â”œâ”€â”€ app1
â”‚ â””â”€â”€ app2
â””â”€â”€ volume
 â””â”€â”€ mysql
 â”œâ”€â”€ auto.cnf
 â””â”€â”€ â€¦
```

## è©¦ã—ã¦æ²¡ã«ãªã£ãŸã‚‚ã®

### browser preview

Coderã§å…¥ã‚ŒãŸãŒå˜ä½“ã§ã¯å‹•ã‹ãšã€google-chromeã¨chrome driverãŒãƒ›ã‚¹ãƒˆå†…ã«å¿…è¦ã ã¨ã‚ã‹ã£ãŸã®ã§å…¥ã‚Œã¦ã¿ã¾ã—ãŸãŒã€

dockerã‚’ç«‹ã¡ä¸Šã’ã¦ã‹ã‚‰browser-previewãŒå‹•ãã‚ˆã†ã«ãªã‚‹ã¾ã§æ•°åˆ†ã‹ã‹ã£ãŸã®ã¨ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ããªã„è‡´å‘½çš„ãªç¾è±¡ã‚’ç¢ºèªã—ãŸã®ã§æ–­å¿µã—ã¾ã—ãŸã€‚

ä»Šå…¥ã‚ŒãŸã‚‰ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã—ã‹ã—ãŸã‚‰VPSã®ã‚¹ãƒšãƒƒã‚¯ã®å•é¡Œã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ã€‚

- google-chrome
    
    ```bash
    RUN wget -q -O â€“ https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add && \
    echo â€˜deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable mainâ€™ | tee /etc/apt/sources.list.d/google-chrome.list && \
    apt-get update && \
    apt-get install -y google-chrome-stable
    ```
    
- ChromeDriver
    
    ```bash
    ADD https://chromedriver.storage.googleapis.com/77.0.3865.10/chromedriver_linux64.zip /opt/chrome/
    RUN cd /opt/chrome/ && \
    unzip chromedriver_linux64.zip
    ```
    

## çµ‚ã‚ã‚Šã«

ç¾åœ¨ã¯ã‚ˆã‚Šä¾¿åˆ©ãªCodespacesã«ç§»ã£ã¦ã—ã¾ã£ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã«ã“ã®æ§‹æˆã§ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ï¼ˆå°‘é¡ãªãŒã‚‰ã‚‚ï¼‰ãŠé‡‘ãŒç™ºç”Ÿã—ãŸã®ã§ã€ã¨ã¦ã‚‚æ€ã„å…¥ã‚ŒãŒæœ‰ã‚Šã¾ã™ã€‚

ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ã„ã‚ã‚“ãªã‚µãƒ¼ãƒ“ã‚¹ã‚„è¨­å®šã‚’ç¶²ç¾…ã—ãªã„ã¨ã„ã‘ãªã‹ã£ãŸã®ã§ã€å¤§å¤‰ã§ã—ãŸãŒã¨ã¦ã‚‚è‰¯ã„å‹‰å¼·ã«ãªã£ãŸã¨æ€ã£ã¦ã„ã¾ã™ï¼